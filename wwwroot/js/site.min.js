function renderPointsCallback(n,t,i,r,u){switch(n.shpName){case"landCoverPoint":case"symbols":return t.drawImage(images[n.shpFile.byteKeys[u]],i,r),!0;case"geology":t.fillStyle="gray";t.textBaseline="top";var f=geologyLabels[n.shpFile.byteKeys[u]];return t.fillText(f,i,r),!0}return!0}function createImages(){var n=function(n){var t=new Image;return t.src=n,t};[].push(n("foo.jpg"))}function renderPolygonCallback(n,t,i){switch(n.shpName){case"bathy":switch(n.shpFile.byteKeys[i-1]){case 0:t.fillStyle="#8CF7A5";break;case 1:t.fillStyle="#63D7FF";break;default:t.fillStyle="#C6FFFF"}break;case"landCoverLine":t.fillStyle=n.shpFile.byteKeys[i-1]==0?"black":"magenta";break;case"bathycontours":return n.shpFile.byteKeys[i-1];case"landCoverRegion":return n.shpFile.byteKeys[i-1]}return null}function setUpSymbolImages(){for(var t,i=0,n=0;n<115;n++)t=document.getElementById("i"+n.toString()),t===null&&i++,images.push(t)}function paintSymbol(n,t,i,r){switch(t.SZFEATDESC.trim()){case"Buoy, lateral, port-hand lateral mark":image=41;r-=4;break;case"Buoy, lateral, starboard-hand lateral mark":image=42;r-=4;break;case"Beacon, lateral, port-hand lateral mark":image=74;break;case"Beacon, lateral, starboard-hand lateral mark":image=75;break;case"Beacon, cardinal, east cardinal mark":image=62;break;case"Beacon, cardinal, west cardinal mark":image=64;break;case"Beacon, cardinal, south cardinal mark":image=63;break;case"Beacon, cardinal, north cardinal mark":image=61;break;case"Beacon, special purpose/general":image=90;break;case"Beacon, isolated danger":image=72;break;case"Beacon, safe water":image=80;break;case"Beacon, cardinal":image=60;break;case"Buoy, special purpose/general":image=44;r-=2;break;case"Buoy, cardinal, north cardinal mark":image=11;r-=3;break;case"Buoy, cardinal, west cardinal mark":image=14;r-=3;break;case"Buoy, cardinal, east cardinal mark":image=12;r-=3;break;case"Buoy, cardinal, south cardinal mark":image=13;r-=3;break;case"Buoy, safe water":image=43;r-=2;break;case"Buoy, isolated danger":image=40;r-=4;break;case"Topmark, cylinder (can)":image=19;break;case"Topmark, 2 cones (points upward)":image=25;break;case"Topmark, 2 cones (points downward)":image=26;break;case"Topmark, 2 cones, point to point":image=22;break;case"Topmark, 2 cones, base to base":image=23;break;case"Topmark, x-shape (St. Andrew's cross)":image=21;break;case"Topmark, cone, point up":image=15;break;case"Topmark, cone, point down":image=16;break;case"Topmark, square":image=28;break;case"Topmark, sphere":image=17;break;case"Topmark, 2 spheres":image=18;break;case"Topmark, rhombus (diamond)":image=24;break;case"Topmark, triangle, point up":image=31;break;case"Topmark, other shape (see INFORM)":image=32;break;case"Fog signal, reed":image=67;break;case"Fog signal, bell":image=68;break;case"Fog signal, horn":image=71;break;case"Fog signal, siren":image=66;break;case"Fog signal, whistle":image=69;break;case"Fog signal, diaphone":image=65;break;case"Radio station":image=5;i+=8;break;case"Radar station, radar surveillance station":image=1;i-=1;break;case"Radar transponder beacon, racon, radar transponder beacon":image=2;i+=12;break;case"Signal station, warning":image=9;break;case"Signal station, traffic":image=8;break;case"Distance mark, distance mark not physically installed":image=59;break;case"Light vessel":image=79;i-=1;r-=3;break;case"Light":image=77;r+=3;break;case"Wreck":image=34;break;case"Wreck, dangerous wreck":image=36;break;case"Wreck, non-dangerous wreck":image=35;break;case"Wreck, distributed remains of wreck":image=37;break;case"Wreck, wreck showing mast/masts":image=38;break;case"Wreck, wreck showing any portion of hull or superstructure":image=39;break;case"Small craft facility":image=10;break;case"Daymark":image=57;break;case"Light float":image=78;break;case"Topmark, sphere over rhombus":image=27;break;case"Topmark, rectangle, vertical":image=29;break;case"Topmark, trapezium, up":image=30;break;case"Topmark, board":image=20;break;case"Buoy, installation, single buoy mooring (SBM or SPM)":image=33;break;case"Offshore platform":image=89;break;case"Offshore Installation":image=46;break;case"Offshore Installation, Fixed platform/structure":image=47;break;case"Offshore Installation, wellhead":image=48;break;case"Offshore Installation, diffuser":image=49;break;case"Offshore Installation, Wind Turbine":image=50;break;case"Offshore Installation, Turbine Substation":image=51;break;case"Offshore Installation, protection structure":image=52;break;case"Offshore Installation, pipeline structure":image=53;break;case"Offshore Installation, manifold":image=54;break;case"Offshore Installation, storage tank":image=55;break;case"Offshore Installation, template":image=56;break;case"Mooring/Warping facility, bollard":image=82;break;case"Mooring/Warping facility, dolphin":image=81;break;case"Mooring/Warping facility, post or pile":image=83;break;case"Obstruction":image=84;break;case"Obstruction, foul ground":image=87;break;case"Obstruction, ground tackle":image=88;break;case"Obstruction, foul area":image=86;break;case"Fog signal, gong":image=70;break;case"Berth":image=0;break;case"Rescue station":image=7;break;case"Coastguard station":image=45;break;case"Pile":image=91;break;case"Pile, post":image=56;break;case"Offshore Installation, Removed":image=56;break;case"Anchorage area":image=58;break;case"Pilot boarding place":image=93;break;case"Pilot boarding place, boarding by pilot-cruising vessel":image=93;break;case"Harbour facility":image=72;break;case"Recommended traffic lane part":image=6;break;case"Radio calling-in point, inbound":image=3;break;case"Radio calling-in point, two-way":image=4;break;default:image=56}return n.drawImage(images[image],i,r),!0}function DecimalLatLong2UTM(n){var a=n.lat<0,u=.9996,r=6378137,e=6356752.3142,v=(r-e)/r,ut=1/v,ft=Math.pow(r*e,.5),o=Math.sqrt(1-Math.pow(e/r,2)),s=Math.pow(o,2)/(1-Math.pow(o,2)),t=(r-e)/(r+e),i=n.lat*Math.PI/180,et=r*(1-Math.pow(o,2))/(Math.pow(1-(Math.pow(o*Math.sin(i)),2)),3/2),h=r/Math.pow(1-Math.pow(o*Math.sin(i),2),.5),y=r*(1-t+5*t*t/4*(1-t)+81*Math.pow(t,4)/64*(1-t)),p=3*r*t/2*(1-t-7*t*t/8*(1-t)+55*Math.pow(t,4)/64),w=15*r*t*t/16*(1-t+3*t*t/4*(1-t)),b=35*r*Math.pow(t,3)/48*(1-t+11*t*t/16),k=315*r*Math.pow(t,4)/51*(1-t),d=y*i-p*Math.sin(2*i)+w*Math.sin(4*i)-b*Math.sin(6*i)+k*Math.sin(8*i),f=(n.lng-GetZoneCM())*3600/1e4,c=Math.PI/648e3,g=d*u,nt=h*Math.sin(i)*Math.cos(i)*Math.pow(c,2)*u*5e7,tt=Math.pow(c,4)*h*Math.sin(i)*Math.pow(Math.cos(i),3)/24*(5-Math.pow(Math.tan(i),2)+9*s*Math.pow(Math.cos(i),2)+4*Math.pow(s,2)*Math.pow(Math.cos(i),4))*u*10000000000000000,it=h*Math.cos(i)*c*u*1e4,rt=Math.pow(c*Math.cos(i),3)*(h/6)*(1-Math.pow(Math.tan(i),2)+s*Math.pow(Math.cos(i),2))*u*1e12,ot=Math.pow((f*c,6)*h*Math.sin(i)*Math.pow(Math.cos(i),5)/720)*(61-58*Math.pow(Math.tan(i),2)+Math.pow(Math.tan(i),4)+270*s*Math.pow(Math.cos(i),2)-330*s*Math.pow(Math.sin(i),2))*u*1e24,l={};return l.x=5e5+(it*f+rt*Math.pow(f,3)),l.y=g+nt*f*f+tt*Math.pow(f,4),a&&(l.y=1e7+l.y),l}function UTM2DecimalLatLong(n,t){zone==56&&(t=1e7-t);var l=6378137,i=.081819191,c=.006739497,a=.9996,p=t/a,s=p/(l*(1-Math.pow(i,2)/4-3*Math.pow(i,4)/64-5*Math.pow(i,6)/256)),e=(1-Math.pow(1-i*i,1/2))/(1+Math.pow(1-i*i,1/2)),w=3*e/2-27*Math.pow(e,3)/32,b=21*Math.pow(e,2)/16-55*Math.pow(e,4)/32,k=151*Math.pow(e,3)/96,d=1097*Math.pow(e,4)/512,u=s+w*Math.sin(2*s)+b*Math.sin(4*s)+k*Math.sin(6*s)+d*Math.sin(8*s),v=l/Math.pow(1-Math.pow(i*Math.sin(u),2),1/2),g=l*(1-i*i)/Math.pow(1-Math.pow(i*Math.sin(u),2),3/2),nt=v*Math.tan(u)/g,y=5e5-n,o=y/(v*a),tt=o*o/2,f=Math.pow(Math.tan(u),2),r=c*Math.pow(Math.cos(u),2),it=(5+3*f+10*r-4*r*r-9*c)*Math.pow(o,4)/24,rt=(61+90*f+298*r+45*f*f-252*c-3*r*r)*Math.pow(o,6)/720,ut=y/(v*a),ft=(1+2*f+r)*Math.pow(o,3)/6,et=(5-2*r+28*f-3*Math.pow(r,2)+8*c+24*Math.pow(f,2))*Math.pow(o,5)/120,ot=(ut-ft+et)/Math.cos(u),st=ot*180/Math.PI,h={};return h.lat=180*(u-nt*(tt+it+rt))/Math.PI,zone==56&&(h.lat=-h.lat),h.lon=GetZoneCM()-st,h}function GetZoneCM(){return 6*zone-183}function roundNumber(n,t){return Math.round(n*Math.pow(10,t))/Math.pow(10,t)}function roundDownNumber(n){return Math.floor(n)}function utm2pixel(n,t){var i={};return i.x=Math.floor((n.x-t.minX)*t.container.offsetWidth/t.zoom),i.y=Math.floor((t.maxY-n.y)*t.container.offsetWidth/t.zoom),i}function utm2pixelX(n,t){return Math.floor((n-t.minX)*t.container.offsetWidth/t.zoom)}function utm2pixelY(n,t){return Math.floor((t.maxY-n)*t.container.offsetWidth/t.zoom)}function pixel2utm(n,t){var i={};return i.x=n.minX+t.x*n.zoom/n.container.offsetWidth,i.y=n.maxY-t.y*obj.zoom/obj.container.offsetWidth,i}function maxX(n){return n.maxX+n.zoom*n.container.offsetHeight/n.container.offsetWidth}function minY(n){return n.maxY-n.zoom*n.container.offsetHeight/n.container.offsetWidth}function log(n){window.console&&window.console.log&&console.log(n)}function Map(n){var i,t,f,c,e;map=this;this.layers=n;i=document.getElementById("map");i.style.position||(i.style.position="relative");t=document.getElementById("canvas1");this.canvas=t;t.style.position="absolute";t.style.left="0px";t.style.top="0px";t.width=window.innerWidth;t.height=window.innerHeight;this.canvas.style.width=window.innerWidth+"px";this.canvas.style.height=window.innerHeight+"px";setUpSymbolImages();document.getElementById("msym").onclick=function(){currentRenderFlags^=RenderFlag.MarineSymbols;map.render()};document.getElementById("lsym").onclick=function(){currentRenderFlags^=RenderFlag.LandFeatures;map.render()};document.getElementById("title").onclick=function(){currentRenderFlags^=RenderFlag.Title;map.render()};var o=0,r=function(){var t,r,i;if(o++==0)for(t=document.getElementById("canvas1"),r=t.getContext("2d"),r.fillStyle="#fadfa8",r.fillRect(0,0,t.width,t.height),i=0;i<n.length;i++)n[i].render();o--},s=function(){var n=window.innerWidth/map.canvas.width,t=window.innerHeight/map.canvas.height,i=n;map.canvas.style.width=window.innerWidth+"px";map.canvas.style.height=window.innerHeight+"px";map.canvas.width=window.innerWidth;map.canvas.height=window.innerHeight;mainbox.width/=t;mainbox.height/=n;log("widthAdj="+n+", heightAdj="+t);map.render()},h=function(n,t){if(n!=0||t!=0){var i=mainbox.width/window.innerWidth;mainbox.x-=n*i;mainbox.y+=t*i;f();r()}},u=function(n,t,i){var u=mainbox.width/window.innerWidth,e=mainbox.x+t*u,o=mainbox.y+(window.innerHeight-i)*u;mainbox.x-=e;mainbox.y-=o;mainbox.x*=n;mainbox.y*=n;mainbox.width*=n;mainbox.height*=n;mainbox.x+=e;mainbox.y+=o;f();r()};this.render=r;this.panBy=h;this.zoomBy=u;f=function(){var n=mainbox.x+mainbox.width,t=mainbox.y+mainbox.height;mainbox.x<zoombox.loX||mainbox.y<zoombox.loY||mainbox.x+mainbox.width>zoombox.hiX||mainbox.y+mainbox.height>zoombox.hiY?(currentRenderFlags|=RenderFlag.UnZoomed,currentRenderFlags&=~RenderFlag.Zoomed):(currentRenderFlags|=RenderFlag.Zoomed,currentRenderFlags&=~RenderFlag.UnZoomed)};c=function(n){var t={x:n.clientX,y:n.clientY},i=function(n){t.x=n.clientX;t.y=n.clientY;n.preventDefault()},r=function(){document.body.style.cursor=null;document.removeEventListener("mousemove",i,!1);document.removeEventListener("mouseup",r,!1)};document.body.style.cursor="hand";document.addEventListener("mousemove",i,!1);document.addEventListener("mouseup",r,!1);n.preventDefault()};window.addEventListener("resize",s,!1);e=function(n){var f=n.clientX,e=n.clientY,t,r;for(f+=document.body.scrollLeft+document.documentElement.scrollLeft,e+=document.body.scrollTop+document.documentElement.scrollTop,t=i;t;t=t.offsetParent)f-=t.offsetLeft,e-=t.offsetTop;r=0;n.wheelDelta?r=n.wheelDelta:n.detail&&(r=-n.detail);r>0?u(.9,f,e):r<0&&u(1.1,f,e);n.preventDefault()};i.addEventListener("mousewheel",e,!1);i.addEventListener("DOMMouseScroll",e,!1)}function hammerIt(n){function e(n,t,i){switch(n){case"panleft":if(t<=0)return!0;break;case"panright":if(t>=0)return!0;break;case"panup":if(i<=0)return!0;break;case"pandown":if(i>=0)return!0}return log("panfail"),!1}var t,i;hammertime=new Hammer(n,{});hammertime.get("pinch").set({enable:!0});hammertime.get("pan").set({direction:Hammer.DIRECTION_ALL});var r=3,f=3,o=n,u=0;hammertime.on("panleft panright panup pandown pinch pinchin pinchout panend pinchend",function(n){if(u++==0)switch(n.type){case"pan":log("pan");break;case"panend":break;case"pinch":r=Math.max(.999,Math.min(f*n.scale,3));log("pinch="+r);break;case"pinchin":map.zoomBy(1.2,n.center.x,n.center.y);log("pinchin");break;case"pinchout":map.zoomBy(.8,n.center.x,n.center.y);log("pinchout");break;case"pinchend":log("pinch delta x="+n.deltaX+",y="+n.deltaY);i=t=0;break;default:log(n.type+" "+n.deltaX+","+n.deltaY);var o=n.deltaX-t,s=n.deltaY-i;t=n.deltaX;i=n.deltaY;e(n.type,o,s)&&map.panBy(o,s)}u--});t=0;i=0}function Layer(n,t,i){var r,u,f;this.shpName=n;this.style=i;this.renderflags=t;r=this;this.render=function(){if(this.shpFile&&(currentRenderFlags&this.renderflags)===this.renderflags){var n=Math.min(map.canvas.width/mainbox.width,map.canvas.height/mainbox.height),t=map.canvas.getContext("2d");this.shpFile.header.shapeType===ShpType.SHAPE_POLYGON||this.shpFile.header.shapeType===ShpType.SHAPE_POLYLINE?renderPolygons(this,t,n):this.shpFile.header.shapeType===ShpType.SHAPE_POINT&&renderPoints(this,t,n)}};u=function(){alert("failed to load "+r.shpName)};f=function(n){var t=n.binaryResponse;log("got data for "+r.shpName+", parsing shapefile");r.shpFile=new ShpFile(t,r.shpName);addShapefileToStorage(r.shpName,r.shpFile);++renderedLayers===map.layers.length&&(console.log("READ LAYERS INTO DATABASE"),map.render())};this.load=function(){this.shpLoader=new BinaryAjax("data/"+this.shpName+".bmp",f,u)}}function renderPoints(n,t,i){var r;for(n.style.fillStyle&&(t.fillStyle=n.style.fillStyle),n.style.strokeStyle&&(t.strokeStyle=n.style.strokeStyle),n.style.lineWidth&&(t.lineWidth=n.style.lineWidth),r=0;r<n.shpFile.records.length;r++){var u=n.shpFile.records[r],f=-1.5+(unscaleX(n,u)-mainbox.x)*i,e=-1.5+map.canvas.height-(unscaleY(n,u)-mainbox.y)*i;renderPointsCallback(n,t,f,e,r)}t2=(new Date).getTime()}function trim(n){for(var n=n.replace(/^\s\s*/,""),t=n.length;/\s/.test(n.charAt(--t)););return n.slice(0,t+1)}function renderPolygons(n,t,i){var o,s,f,u,v,e,h,y,c,l,a,r,p,w;if(n.style)for(o in n.style)t[o]=n.style[o];for(s=0,f=0,u=0;u<n.shpFile.header.recordCount;){for(v=n.shpFile.records[u++],e=renderPolygonCallback(n,t,u),t.beginPath(),h=0;h<v;h++){if(s>n.shpFile.parts.length){alert("format");u=n.shpFile.header.recordCount;break}if(y=n.shpFile.parts[s++],f>n.shpFile.points.length){alert("format");u=n.shpFile.header.recordCount;break}if(r=n.shpFile.points[f++],r===null)break;if(c=unscaleX(n,r),l=unscaleY(n,r),e!==null&&(e===undefined&&(e=0),t.textStyle&&(t.fillStyle=t.textStyle),t.textBaseline="top",t.fillText(e,(c-mainbox.x)*i,map.canvas.height-(l-mainbox.y)*i)),t.strokeStyle)for(t.moveTo((c-mainbox.x)*i,map.canvas.height-(l-mainbox.y)*i),a=1;a<y;a++){if(f>n.shpFile.points.length)break;if(r=n.shpFile.points[f++],r===null)break;p=unscaleX(n,r);w=unscaleY(n,r);t.lineTo((p-mainbox.x)*i,map.canvas.height-(w-mainbox.y)*i)}}n.style.fillStyle&&t.fill();n.style.strokeStyle&&t.stroke()}}function unscaleX(n,t){return t.x/n.shpFile.header.widthAdj+n.shpFile.header.boundsXY.x}function unscaleY(n,t){return t.y/n.shpFile.header.heightAdj+n.shpFile.header.boundsXY.y}function scale(n,t){return n-t}function ShpFile(n,t){var i=new BinaryFileWrapper(n);this.header=new ShpHeader(i,t);log("got header, parsing records");this.records=new Array(this.header.recordCount);this.header.shapeType===1?processImages(i,this):processPoly(i,this)}function processImages(n,t){for(var i=0;i<t.header.recordCount;i++)t.records[i]={x:n.getShort(),y:n.getShort()};switch(t.header.shpName){case"symbols":processByteArray(n,t);break;case"landCoverPoint":processByteArray(n,t);break;case"geology":processByteArray(n,t)}}function processByteArray(n,t){t.byteKeys=new Array(t.header.recordCount);for(var i=0;i<t.header.recordCount;i++)t.byteKeys[i]=n.getByte()}function processStringArray(n,t){t.byteKeys=new Array(t.header.recordCount);for(var i=0;i<t.header.recordCount;i++)t.byteKeys[i]=n.getString()}function processPoly(n,t){var i,r,u;for(t.partsCount=n.getShort(),t.pointsCount=n.getLong(),i=0;i<t.header.recordCount;i++)t.records[i]=n.getShort();for(t.parts=new Array(t.partsCount),t.points=new Array(t.pointsCount),r=0;r<t.partsCount;r++)t.parts[r]=n.getShort();for(u=0;u<t.pointsCount;u++)t.points[u]={x:n.getShort(),y:n.getShort()};switch(t.header.shpName){case"bathy":processByteArray(n,t);break;case"bathycontours":processByteArray(n,t);break;case"landCoverLine":processByteArray(n,t);break;case"landCoverRegion":processStringArray(n,t);break;case"majorRoads":processStringArray(n,t)}}function ShpHeader(n,t){this.shpName=t;this.shapeType=n.getByte();this.boundsXY={x:n.getDouble(),y:n.getDouble(),width:n.getDouble(),height:n.getDouble()};this.widthAdj=n.getDouble();this.heightAdj=n.getDouble();this.recordCount=n.getShort()}function DbfFile(n){var t,i,r,u;for(this.src=new BinaryFileWrapper(n),t=(new Date).getTime(),this.header=new DbfHeader(this.src),i=(new Date).getTime(),window.console&&window.console.log&&console.log("parsed dbf header in "+(i-t)+" ms"),t=(new Date).getTime(),this.records=[],r=0;r<this.header.recordCount;r++)u=this.getRecord(r),this.records.push(u);i=(new Date).getTime();window.console&&window.console.log&&console.log("parsed dbf records in "+(i-t)+" ms")}function DbfHeader(n){for(n.bigEndian=!1,this.version=n.getSByte(),this.updateYear=1900+n.getByte(),this.updateMonth=n.getByte(),this.updateDay=n.getByte(),this.recordCount=n.getLong(),this.headerSize=n.getShort(),this.recordSize=n.getShort(),n.position+=2,this.incompleteTransaction=n.getByte(),this.encrypted=n.getByte(),n.position+=12,this.mdx=n.getByte(),this.language=n.getByte(),n.position+=2,this.fields=[];n.getSByte()!==13;)n.position-=1,this.fields.push(new DbfField(n));this.recordsOffset=this.headerSize+1}function DbfField(n){this.name=this.readZeroTermANSIString(n);n.position+=10-this.name.length;this.type=n.getByte();this.address=n.getLong();this.length=n.getByte();this.decimals=n.getByte();n.position+=2;this.id=n.getByte();n.position+=2;this.setFlag=n.getByte();n.position+=7;this.indexFlag=n.getByte()}function DbfRecord(n,t){var i,r;for(this.offset=n.position,this.values={},i=0;i<t.fields.length;i++)r=t.fields[i],this.values[r.name]=n.getString(r.length)}function storageReadAll(n){map=n;window.indexedDB||window.alert("Your browser will only support online access.");var t=indexedDB.open("shapefiles",dbVersion),i;t.onsuccess=function(){i=t.result;readAll(i)};t.onerror=function(){alert("Unable to initialise db")};t.onupgradeneeded=function(n){i=n.target.result;console.log("onupgradeneeded");var t=i.createObjectStore("shapefile")}}function addShapefileToStorage(n,t){var r=indexedDB.open("shapefiles",dbVersion),i;r.onsuccess=function(){i=r.result;var u=i.transaction("shapefile","readwrite").objectStore("shapefile").put(t,n);u.onsuccess=function(){i.close()}};r.onerror=function(){i.close();alert("Unable to initialise db")};r.onupgradeneeded=function(n){i=n.target.result;console.log("onupgradeneeded");var t=i.createObjectStore("shapefile")};r.onerror=function(){alert("Unable to add layer")}}function readAll(n){function t(){for(var t=document.getElementById("canvas1"),n=0;n<map.layers.length;n++)map.layers[n].shpFile||map.layers[n].load();map.render()}try{var i=n.transaction("shapefile","readwrite").objectStore("shapefile")}catch(r){t();n.close();indexedDB.deleteDatabase("shapefile1");return}i.openCursor().onsuccess=function(i){var u=i.target.result,r;if(u){for(r=0;r<map.layers.length;r++)map.layers[r].shpName==u.key&&(map.layers[r].shpFile=u.value,++renderedLayers==map.layers.length&&(console.log("ALL LAYERS IN DATABASE"),map.render()));u.continue()}else t();n.close()}}function BinaryFileWrapper(n){this.position=0;this.bigEndian=!0;this.getByte=function(){var t=n.getByteAt(this.position);return this.position++,t};this.getLength=function(){return n.getLength()};this.getSByte=function(){var t=n.getSByteAt(this.position);return this.position++,t};this.getShort=function(){var t=n.getShortAt(this.position,this.bigEndian);return this.position+=2,t};this.getSShort=function(){var t=n.getSShortAt(this.position,this.bigEndian);return this.position+=2,t};this.getLong=function(){var t=n.getLongAt(this.position,this.bigEndian);return this.position+=4,t};this.getSLong=function(){var t=n.getSLongAt(this.position,this.bigEndian);return this.position+=4,t};this.getString=function(){var t=this.getByte(),i=n.getStringAt(this.position,t);return this.position+=t,i};this.getDoubleAt=function(t,i){var r=n.getLongAt(t+(i?0:4),i),f=n.getLongAt(t+(i?4:0),i),e=r>>31?-1:1,u=(r>>20&2047)-1023;return e*(r&1048575|1048576)*1/Math.pow(2,20)*Math.pow(2,u)+f*1/Math.pow(2,52)*Math.pow(2,u)};this.getDouble=function(){var n=this.getDoubleAt(this.position,this.bigEndian);return this.position+=8,n};this.getChar=function(){var t=n.getCharAt(this.position);return this.position++,t}}var geologyLabels,images,RenderFlag,mindiff,maxdiff,ShpType,dbVersion,db,map,BinaryFile,BinaryAjax;(function(n,t,i,r){"use strict";function ci(n,t,i){return setTimeout(ai(n,i),t)}function ut(n,t,i){return Array.isArray(n)?(v(n,i[t],i),!0):!1}function v(n,t,i){var u;if(n)if(n.forEach)n.forEach(t,i);else if(n.length!==r)for(u=0;u<n.length;)t.call(i,n[u],u,n),u++;else for(u in n)n.hasOwnProperty(u)&&t.call(i,n[u],u,n)}function or(t,i,r){var u="DEPRECATED METHOD: "+i+"\n"+r+" AT \n";return function(){var i=new Error("get-stack-trace"),f=i&&i.stack?i.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",r=n.console&&(n.console.warn||n.console.log);return r&&r.call(n.console,u,f),t.apply(this,arguments)}}function o(n,t,i){var u=t.prototype,r;r=n.prototype=Object.create(u);r.constructor=n;r._super=u;i&&y(r,i)}function ai(n,t){return function(){return n.apply(t,arguments)}}function vi(n,t){return typeof n==bu?n.apply(t?t[0]||r:r,t):n}function hr(n,t){return n===r?t:n}function pt(n,t,i){v(bt(t),function(t){n.addEventListener(t,i,!1)})}function wt(n,t,i){v(bt(t),function(t){n.removeEventListener(t,i,!1)})}function cr(n,t){while(n){if(n==t)return!0;n=n.parentNode}return!1}function g(n,t){return n.indexOf(t)>-1}function bt(n){return n.trim().split(/\s+/g)}function ft(n,t,i){if(n.indexOf&&!i)return n.indexOf(t);for(var r=0;r<n.length;){if(i&&n[r][i]==t||!i&&n[r]===t)return r;r++}return-1}function kt(n){return Array.prototype.slice.call(n,0)}function lr(n,t,i){for(var u=[],e=[],r=0,f;r<n.length;)f=t?n[r][t]:n[r],ft(e,f)<0&&u.push(n[r]),e[r]=f,r++;return i&&(u=t?u.sort(function(n,i){return n[t]>i[t]}):u.sort()),u}function dt(n,t){for(var i,u,e=t[0].toUpperCase()+t.slice(1),f=0;f<er.length;){if(i=er[f],u=i?i+e:t,u in n)return u;f++}return r}function ku(){return ar++}function vr(t){var i=t.ownerDocument||t;return i.defaultView||i.parentWindow||n}function s(n,t){var i=this;this.manager=n;this.callback=t;this.element=n.element;this.target=n.options.inputTarget;this.domHandler=function(t){vi(n.options.enable,[n])&&i.handler(t)};this.init()}function tf(n){var t,i=n.options.inputClass;return t=i?i:du?wi:gu?ri:yr?ki:ii,new t(n,rf)}function rf(n,t,i){var r=i.pointers.length,o=i.changedPointers.length,s=t&f&&r-o==0,h=t&(u|e)&&r-o==0;i.isFirst=!!s;i.isFinal=!!h;s&&(n.session={});i.eventType=t;uf(n,i);n.emit("hammer.input",i);n.recognize(i);n.session.prevInput=i}function uf(n,t){var i=n.session,f=t.pointers,o=f.length,r,e;i.firstInput||(i.firstInput=br(t));o>1&&!i.firstMultiple?i.firstMultiple=br(t):o===1&&(i.firstMultiple=!1);var s=i.firstInput,u=i.firstMultiple,h=u?u.center:s.center,c=t.center=kr(f);t.timeStamp=hi();t.deltaTime=t.timeStamp-s.timeStamp;t.angle=pi(h,c);t.distance=ti(h,c);ff(i,t);t.offsetDirection=gr(t.deltaX,t.deltaY);r=dr(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=r.x;t.overallVelocityY=r.y;t.overallVelocity=d(r.x)>d(r.y)?r.x:r.y;t.scale=u?sf(u.pointers,f):1;t.rotation=u?of(u.pointers,f):0;t.maxPointers=i.prevInput?t.pointers.length>i.prevInput.maxPointers?t.pointers.length:i.prevInput.maxPointers:t.pointers.length;ef(i,t);e=n.element;cr(t.srcEvent.target,e)&&(e=t.srcEvent.target);t.target=e}function ff(n,t){var i=t.center,r=n.offsetDelta||{},e=n.prevDelta||{},o=n.prevInput||{};(t.eventType===f||o.eventType===u)&&(e=n.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=n.offsetDelta={x:i.x,y:i.y});t.deltaX=e.x+(i.x-r.x);t.deltaY=e.y+(i.y-r.y)}function ef(n,t){var i=n.lastInterval||t,c=t.timeStamp-i.timeStamp,f,o,s,h;if(t.eventType!=e&&(c>nf||i.velocity===r)){var l=t.deltaX-i.deltaX,a=t.deltaY-i.deltaY,u=dr(c,l,a);o=u.x;s=u.y;f=d(u.x)>d(u.y)?u.x:u.y;h=gr(l,a);n.lastInterval=t}else f=i.velocity,o=i.velocityX,s=i.velocityY,h=i.direction;t.velocity=f;t.velocityX=o;t.velocityY=s;t.direction=h}function br(n){for(var i=[],t=0;t<n.pointers.length;)i[t]={clientX:rt(n.pointers[t].clientX),clientY:rt(n.pointers[t].clientY)},t++;return{timeStamp:hi(),pointers:i,center:kr(i),deltaX:n.deltaX,deltaY:n.deltaY}}function kr(n){var t=n.length;if(t===1)return{x:rt(n[0].clientX),y:rt(n[0].clientY)};for(var r=0,u=0,i=0;i<t;)r+=n[i].clientX,u+=n[i].clientY,i++;return{x:rt(r/t),y:rt(u/t)}}function dr(n,t,i){return{x:t/n||0,y:i/n||0}}function gr(n,t){return n===t?gt:d(n)>=d(t)?n<0?st:ht:t<0?ct:lt}function ti(n,t,i){i||(i=wr);var r=t[i[0]]-n[i[0]],u=t[i[1]]-n[i[1]];return Math.sqrt(r*r+u*u)}function pi(n,t,i){i||(i=wr);var r=t[i[0]]-n[i[0]],u=t[i[1]]-n[i[1]];return Math.atan2(u,r)*180/Math.PI}function of(n,t){return pi(t[1],t[0],ni)+pi(n[1],n[0],ni)}function sf(n,t){return ti(t[0],t[1],ni)/ti(n[0],n[1],ni)}function ii(){this.evEl=cf;this.evWin=lf;this.pressed=!1;s.apply(this,arguments)}function wi(){this.evEl=nu;this.evWin=tu;s.apply(this,arguments);this.store=this.manager.session.pointerEvents=[]}function iu(){this.evTarget=pf;this.evWin=wf;this.started=!1;s.apply(this,arguments)}function bf(n,t){var i=kt(n.touches),r=kt(n.changedTouches);return t&(u|e)&&(i=lr(i.concat(r),"identifier",!0)),[i,r]}function ri(){this.evTarget=uu;this.targetIds={};s.apply(this,arguments)}function kf(n,t){var r=kt(n.touches),o=this.targetIds;if(t&(f|nt)&&r.length===1)return o[r[0].identifier]=!0,[r,r];var i,s,h=kt(n.changedTouches),c=[],l=this.target;if(s=r.filter(function(n){return cr(n.target,l)}),t===f)for(i=0;i<s.length;)o[s[i].identifier]=!0,i++;for(i=0;i<h.length;)o[h[i].identifier]&&c.push(h[i]),t&(u|e)&&delete o[h[i].identifier],i++;if(c.length)return[lr(s.concat(c),"identifier",!0),c]}function ki(){s.apply(this,arguments);var n=ai(this.handler,this);this.touch=new ri(this.manager,n);this.mouse=new ii(this.manager,n);this.primaryTouch=null;this.lastTouches=[]}function df(n,t){n&f?(this.primaryTouch=t.changedPointers[0].identifier,eu.call(this,t)):n&(u|e)&&eu.call(this,t)}function eu(n){var t=n.changedPointers[0],i,r,u;t.identifier===this.primaryTouch&&(i={x:t.clientX,y:t.clientY},this.lastTouches.push(i),r=this.lastTouches,u=function(){var n=r.indexOf(i);n>-1&&r.splice(n,1)},setTimeout(u,fu))}function gf(n){for(var r=n.srcEvent.clientX,u=n.srcEvent.clientY,t=0;t<this.lastTouches.length;t++){var i=this.lastTouches[t],f=Math.abs(r-i.x),e=Math.abs(u-i.y);if(f<=bi&&e<=bi)return!0}return!1}function gi(n,t){this.manager=n;this.set(t)}function ne(n){if(g(n,it))return it;var t=g(n,at),i=g(n,vt);return t&&i?it:t||i?t?at:vt:g(n,di)?di:cu}function te(){if(!su)return!1;var t={},i=n.CSS&&n.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(r){t[r]=i?n.CSS.supports("touch-action",r):!0}),t}function w(n){this.options=y({},this.defaults,n||{});this.id=ku();this.manager=null;this.options.enable=hr(this.options.enable,!0);this.state=fi;this.simultaneous={};this.requireFail=[]}function lu(n){return n&yt?"cancel":n&k?"end":n&et?"move":n&h?"start":""}function au(n){return n==lt?"down":n==ct?"up":n==st?"left":n==ht?"right":""}function ei(n,t){var i=t.manager;return i?i.get(n):n}function c(){w.apply(this,arguments)}function oi(){c.apply(this,arguments);this.pX=null;this.pY=null}function nr(){c.apply(this,arguments)}function tr(){w.apply(this,arguments);this._timer=null;this._input=null}function ir(){c.apply(this,arguments)}function rr(){c.apply(this,arguments)}function si(){w.apply(this,arguments);this.pTime=!1;this.pCenter=!1;this._timer=null;this._input=null;this.count=0}function b(n,t){return t=t||{},t.recognizers=hr(t.recognizers,b.defaults.preset),new fr(n,t)}function fr(n,t){this.options=y({},b.defaults,t||{});this.options.inputTarget=this.options.inputTarget||n;this.handlers={};this.session={};this.recognizers=[];this.oldCssProps={};this.element=n;this.input=tf(this);this.touchAction=new gi(this,this.options.touchAction);yu(this,!0);v(this.options.recognizers,function(n){var t=this.add(new n[0](n[1]));n[2]&&t.recognizeWith(n[2]);n[3]&&t.requireFailure(n[3])},this)}function yu(n,t){var r=n.element,i;r.style&&(v(n.options.cssProps,function(u,f){i=dt(r.style,f);t?(n.oldCssProps[i]=r.style[i],r.style[i]=u):r.style[i]=n.oldCssProps[i]||""}),t||(n.oldCssProps={}))}function ie(n,i){var r=t.createEvent("Event");r.initEvent(n,!0,!0);r.gesture=i;i.target.dispatchEvent(r)}var er=["","webkit","Moz","MS","ms","o"],wu=t.createElement("div"),bu="function",rt=Math.round,d=Math.abs,hi=Date.now,y,li,sr,ar,ru,uu,fu,bi,vu,ur,pu;y=typeof Object.assign!="function"?function(n){var f,i,t,u;if(n===r||n===null)throw new TypeError("Cannot convert undefined or null to object");for(f=Object(n),i=1;i<arguments.length;i++)if(t=arguments[i],t!==r&&t!==null)for(u in t)t.hasOwnProperty(u)&&(f[u]=t[u]);return f}:Object.assign;li=or(function(n,t,i){for(var f=Object.keys(t),u=0;u<f.length;)(!i||i&&n[f[u]]===r)&&(n[f[u]]=t[f[u]]),u++;return n},"extend","Use `assign`.");sr=or(function(n,t){return li(n,t,!0)},"merge","Use `assign`.");ar=1;var yr="ontouchstart"in n,du=dt(n,"PointerEvent")!==r,gu=yr&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),ot="touch",yi="mouse",nf=25,f=1,nt=2,u=4,e=8,gt=1,st=2,ht=4,ct=8,lt=16,l=st|ht,tt=ct|lt,pr=l|tt,wr=["x","y"],ni=["clientX","clientY"];s.prototype={handler:function(){},init:function(){this.evEl&&pt(this.element,this.evEl,this.domHandler);this.evTarget&&pt(this.target,this.evTarget,this.domHandler);this.evWin&&pt(vr(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&wt(this.element,this.evEl,this.domHandler);this.evTarget&&wt(this.target,this.evTarget,this.domHandler);this.evWin&&wt(vr(this.element),this.evWin,this.domHandler)}};var hf={mousedown:f,mousemove:nt,mouseup:u},cf="mousedown",lf="mousemove mouseup";o(ii,s,{handler:function(n){var t=hf[n.type];(t&f&&n.button===0&&(this.pressed=!0),t&nt&&n.which!==1&&(t=u),this.pressed)&&(t&u&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[n],changedPointers:[n],pointerType:yi,srcEvent:n}))}});var af={pointerdown:f,pointermove:nt,pointerup:u,pointercancel:e,pointerout:e},vf={2:ot,3:"pen",4:yi,5:"kinect"},nu="pointerdown",tu="pointermove pointerup pointercancel";n.MSPointerEvent&&!n.PointerEvent&&(nu="MSPointerDown",tu="MSPointerMove MSPointerUp MSPointerCancel");o(wi,s,{handler:function(n){var t=this.store,o=!1,h=n.type.toLowerCase().replace("ms",""),r=af[h],s=vf[n.pointerType]||n.pointerType,c=s==ot,i=ft(t,n.pointerId,"pointerId");(r&f&&(n.button===0||c)?i<0&&(t.push(n),i=t.length-1):r&(u|e)&&(o=!0),i<0)||(t[i]=n,this.callback(this.manager,r,{pointers:t,changedPointers:[n],pointerType:s,srcEvent:n}),o&&t.splice(i,1))}});var yf={touchstart:f,touchmove:nt,touchend:u,touchcancel:e},pf="touchstart",wf="touchstart touchmove touchend touchcancel";o(iu,s,{handler:function(n){var i=yf[n.type],t;(i===f&&(this.started=!0),this.started)&&(t=bf.call(this,n,i),i&(u|e)&&t[0].length-t[1].length==0&&(this.started=!1),this.callback(this.manager,i,{pointers:t[0],changedPointers:t[1],pointerType:ot,srcEvent:n}))}});ru={touchstart:f,touchmove:nt,touchend:u,touchcancel:e};uu="touchstart touchmove touchend touchcancel";o(ri,s,{handler:function(n){var i=ru[n.type],t=kf.call(this,n,i);t&&this.callback(this.manager,i,{pointers:t[0],changedPointers:t[1],pointerType:ot,srcEvent:n})}});fu=2500;bi=25;o(ki,s,{handler:function(n,t,i){var u=i.pointerType==ot,r=i.pointerType==yi;if(!r||!i.sourceCapabilities||!i.sourceCapabilities.firesTouchEvents){if(u)df.call(this,t,i);else if(r&&gf.call(this,i))return;this.callback(n,t,i)}},destroy:function(){this.touch.destroy();this.mouse.destroy()}});var ou=dt(wu.style,"touchAction"),su=ou!==r,hu="compute",cu="auto",di="manipulation",it="none",at="pan-x",vt="pan-y",ui=te();gi.prototype={set:function(n){n==hu&&(n=this.compute());su&&this.manager.element.style&&ui[n]&&(this.manager.element.style[ou]=n);this.actions=n.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var n=[];return v(this.manager.recognizers,function(t){vi(t.options.enable,[t])&&(n=n.concat(t.getTouchAction()))}),ne(n.join(" "))},preventDefaults:function(n){var i=n.srcEvent,r=n.offsetDirection;if(this.manager.session.prevented){i.preventDefault();return}var t=this.actions,u=g(t,it)&&!ui[it],f=g(t,vt)&&!ui[vt],e=g(t,at)&&!ui[at];if(u){var o=n.pointers.length===1,s=n.distance<2,h=n.deltaTime<250;if(o&&s&&h)return}if(!e||!f)return u||f&&r&l||e&&r&tt?this.preventSrc(i):void 0},preventSrc:function(n){this.manager.session.prevented=!0;n.preventDefault()}};var fi=1,h=2,et=4,k=8,p=k,yt=16,a=32;w.prototype={defaults:{},set:function(n){return y(this.options,n),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(n){if(ut(n,"recognizeWith",this))return this;var t=this.simultaneous;return n=ei(n,this),t[n.id]||(t[n.id]=n,n.recognizeWith(this)),this},dropRecognizeWith:function(n){return ut(n,"dropRecognizeWith",this)?this:(n=ei(n,this),delete this.simultaneous[n.id],this)},requireFailure:function(n){if(ut(n,"requireFailure",this))return this;var t=this.requireFail;return n=ei(n,this),ft(t,n)===-1&&(t.push(n),n.requireFailure(this)),this},dropRequireFailure:function(n){if(ut(n,"dropRequireFailure",this))return this;n=ei(n,this);var t=ft(this.requireFail,n);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(n){return!!this.simultaneous[n.id]},emit:function(n){function r(i){t.manager.emit(i,n)}var t=this,i=this.state;i<k&&r(t.options.event+lu(i));r(t.options.event);n.additionalEvent&&r(n.additionalEvent);i>=k&&r(t.options.event+lu(i))},tryEmit:function(n){if(this.canEmit())return this.emit(n);this.state=a},canEmit:function(){for(var n=0;n<this.requireFail.length;){if(!(this.requireFail[n].state&(a|fi)))return!1;n++}return!0},recognize:function(n){var t=y({},n);if(!vi(this.options.enable,[this,t])){this.reset();this.state=a;return}this.state&(p|yt|a)&&(this.state=fi);this.state=this.process(t);this.state&(h|et|k|yt)&&this.tryEmit(t)},process:function(){},getTouchAction:function(){},reset:function(){}};o(c,w,{defaults:{pointers:1},attrTest:function(n){var t=this.options.pointers;return t===0||n.pointers.length===t},process:function(n){var t=this.state,i=n.eventType,r=t&(h|et),f=this.attrTest(n);return r&&(i&e||!f)?t|yt:r||f?i&u?t|k:(t&h)?t|et:h:a}});o(oi,c,{defaults:{event:"pan",threshold:10,pointers:1,direction:pr},getTouchAction:function(){var t=this.options.direction,n=[];return t&l&&n.push(vt),t&tt&&n.push(at),n},directionTest:function(n){var i=this.options,r=!0,u=n.distance,t=n.direction,f=n.deltaX,e=n.deltaY;return t&i.direction||(i.direction&l?(t=f===0?gt:f<0?st:ht,r=f!=this.pX,u=Math.abs(n.deltaX)):(t=e===0?gt:e<0?ct:lt,r=e!=this.pY,u=Math.abs(n.deltaY))),n.direction=t,r&&u>i.threshold&&t&i.direction},attrTest:function(n){return c.prototype.attrTest.call(this,n)&&(this.state&h||!(this.state&h)&&this.directionTest(n))},emit:function(n){this.pX=n.deltaX;this.pY=n.deltaY;var t=au(n.direction);t&&(n.additionalEvent=this.options.event+t);this._super.emit.call(this,n)}});o(nr,c,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[it]},attrTest:function(n){return this._super.attrTest.call(this,n)&&(Math.abs(n.scale-1)>this.options.threshold||this.state&h)},emit:function(n){if(n.scale!==1){var t=n.scale<1?"in":"out";n.additionalEvent=this.options.event+t}this._super.emit.call(this,n)}});o(tr,w,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[cu]},process:function(n){var t=this.options,i=n.pointers.length===t.pointers,r=n.distance<t.threshold,o=n.deltaTime>t.time;if(this._input=n,!r||!i||n.eventType&(u|e)&&!o)this.reset();else if(n.eventType&f)this.reset(),this._timer=ci(function(){this.state=p;this.tryEmit()},t.time,this);else if(n.eventType&u)return p;return a},reset:function(){clearTimeout(this._timer)},emit:function(n){this.state===p&&(n&&n.eventType&u?this.manager.emit(this.options.event+"up",n):(this._input.timeStamp=hi(),this.manager.emit(this.options.event,this._input)))}});o(ir,c,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[it]},attrTest:function(n){return this._super.attrTest.call(this,n)&&(Math.abs(n.rotation)>this.options.threshold||this.state&h)}});o(rr,c,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:l|tt,pointers:1},getTouchAction:function(){return oi.prototype.getTouchAction.call(this)},attrTest:function(n){var t=this.options.direction,i;return t&(l|tt)?i=n.overallVelocity:t&l?i=n.overallVelocityX:t&tt&&(i=n.overallVelocityY),this._super.attrTest.call(this,n)&&t&n.offsetDirection&&n.distance>this.options.threshold&&n.maxPointers==this.options.pointers&&d(i)>this.options.velocity&&n.eventType&u},emit:function(n){var t=au(n.offsetDirection);t&&this.manager.emit(this.options.event+t,n);this.manager.emit(this.options.event,n)}});o(si,w,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[di]},process:function(n){var t=this.options,o=n.pointers.length===t.pointers,s=n.distance<t.threshold,c=n.deltaTime<t.time,i,r,e;if(this.reset(),n.eventType&f&&this.count===0)return this.failTimeout();if(s&&c&&o){if(n.eventType!=u)return this.failTimeout();if(i=this.pTime?n.timeStamp-this.pTime<t.interval:!0,r=!this.pCenter||ti(this.pCenter,n.center)<t.posThreshold,this.pTime=n.timeStamp,this.pCenter=n.center,r&&i?this.count+=1:this.count=1,this._input=n,e=this.count%t.taps,e===0)return this.hasRequireFailures()?(this._timer=ci(function(){this.state=p;this.tryEmit()},t.interval,this),h):p}return a},failTimeout:function(){return this._timer=ci(function(){this.state=a},this.options.interval,this),a},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==p&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});b.VERSION="2.0.8";b.defaults={domEvents:!1,touchAction:hu,enable:!0,inputTarget:null,inputClass:null,preset:[[ir,{enable:!1}],[nr,{enable:!1},["rotate"]],[rr,{direction:l}],[oi,{direction:l},["swipe"]],[si],[si,{event:"doubletap",taps:2},["tap"]],[tr]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};vu=1;ur=2;fr.prototype={set:function(n){return y(this.options,n),n.touchAction&&this.touchAction.update(),n.inputTarget&&(this.input.destroy(),this.input.target=n.inputTarget,this.input.init()),this},stop:function(n){this.session.stopped=n?ur:vu},recognize:function(n){var r=this.session,i,f,t,u;if(!r.stopped)for(this.touchAction.preventDefaults(n),f=this.recognizers,t=r.curRecognizer,(!t||t&&t.state&p)&&(t=r.curRecognizer=null),u=0;u<f.length;)i=f[u],r.stopped!==ur&&(!t||i==t||i.canRecognizeWith(t))?i.recognize(n):i.reset(),!t&&i.state&(h|et|k)&&(t=r.curRecognizer=i),u++},get:function(n){var i,t;if(n instanceof w)return n;for(i=this.recognizers,t=0;t<i.length;t++)if(i[t].options.event==n)return i[t];return null},add:function(n){if(ut(n,"add",this))return this;var t=this.get(n.options.event);return t&&this.remove(t),this.recognizers.push(n),n.manager=this,this.touchAction.update(),n},remove:function(n){if(ut(n,"remove",this))return this;if(n=this.get(n),n){var t=this.recognizers,i=ft(t,n);i!==-1&&(t.splice(i,1),this.touchAction.update())}return this},on:function(n,t){if(n!==r&&t!==r){var i=this.handlers;return v(bt(n),function(n){i[n]=i[n]||[];i[n].push(t)}),this}},off:function(n,t){if(n!==r){var i=this.handlers;return v(bt(n),function(n){t?i[n]&&i[n].splice(ft(i[n],t),1):delete i[n]}),this}},emit:function(n,t){var i,r;if(this.options.domEvents&&ie(n,t),i=this.handlers[n]&&this.handlers[n].slice(),i&&i.length)for(t.type=n,t.preventDefault=function(){t.srcEvent.preventDefault()},r=0;r<i.length;)i[r](t),r++},destroy:function(){this.element&&yu(this,!1);this.handlers={};this.session={};this.input.destroy();this.element=null}};y(b,{INPUT_START:f,INPUT_MOVE:nt,INPUT_END:u,INPUT_CANCEL:e,STATE_POSSIBLE:fi,STATE_BEGAN:h,STATE_CHANGED:et,STATE_ENDED:k,STATE_RECOGNIZED:p,STATE_CANCELLED:yt,STATE_FAILED:a,DIRECTION_NONE:gt,DIRECTION_LEFT:st,DIRECTION_RIGHT:ht,DIRECTION_UP:ct,DIRECTION_DOWN:lt,DIRECTION_HORIZONTAL:l,DIRECTION_VERTICAL:tt,DIRECTION_ALL:pr,Manager:fr,Input:s,TouchAction:gi,TouchInput:ri,MouseInput:ii,PointerEventInput:wi,TouchMouseInput:ki,SingleTouchInput:iu,Recognizer:w,AttrRecognizer:c,Tap:si,Pan:oi,Swipe:rr,Pinch:nr,Rotate:ir,Press:tr,on:pt,off:wt,each:v,merge:sr,extend:li,assign:y,inherit:o,bindFn:ai,prefixed:dt});pu=typeof n!="undefined"?n:typeof self!="undefined"?self:{};pu.Hammer=b;typeof define=="function"&&define.amd?define(function(){return b}):typeof module!="undefined"&&module.exports?module.exports=b:n[i]=b})(window,document,"Hammer");geologyLabels=["clay","gravel","gravel,rock","gravel,shells","gravel,shells,pebbles","mud","mud,sand","mud,sand,clay","mud,shells,gravel,sand","mud,shells,pebbles,gravel,sand","mud,shells,sand","pebbles,shells","rock","rock,shells","sand","sand,gravel","sand,pebbles","sand,pebbles,gravel","sand,rock","sand,shells","sand,shells,gravel","sand,shells,pebbles","sand,shells,pebbles,gravel","sand,shells,stone"];images=[];window.applicationCache.addEventListener("updateready",function(){log("AppCache Update");window.applicationCache.swapCache();window.location.reload()},!1);var RenderFlag={UnZoomed:1,Zoomed:2,MarineSymbols:4,LandFeatures:8,Title:16},renderedLayers=0,canvas=null,map;hammerIt(document.getElementById("canvas1"));RenderFlag={UnZoomed:1,Zoomed:2,MarineSymbols:4,LandFeatures:8,Title:16};mindiff=0;maxdiff=0;ShpType={SHAPE_UNKNOWN:-1,SHAPE_NULL:0,SHAPE_POINT:1,SHAPE_POLYLINE:3,SHAPE_POLYGON:5,SHAPE_MULTIPOINT:8,SHAPE_POINTZ:11,SHAPE_POLYLINEZ:13,SHAPE_POLYGONZ:15,SHAPE_MULTIPOINTZ:18,SHAPE_POINTM:21,SHAPE_POLYLINEM:23,SHAPE_POLYGONM:25,SHAPE_MULTIPOINTM:28,SHAPE_MULTIPATCH:31};DbfFile.prototype.getRecord=function(n){if(n>this.header.recordCount)throw new DbfError("",DbfError.ERROR_OUTOFBOUNDS);return this.src.position=this.header.recordsOffset+n*this.header.recordSize,this.src.bigEndian=!1,new DbfRecord(this.src,this.header)};DbfField.prototype.readZeroTermANSIString=function(n){for(var t=[],i;i=n.getByte();)t[t.length]=String.fromCharCode(i);return t.join("")};window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction;window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange;dbVersion=1;var WebApi=function(){function n(){var n=null;return window.XMLHttpRequest?n=new XMLHttpRequest:window.ActiveXObject&&(n=new ActiveXObject("Microsoft.XMLHTTP")),n}function t(t,i,r){var u=n();u&&(u.open("GET",t,!0),u.setRequestHeader("Content-Type","application/json"),u.overrideMimeType&&u.overrideMimeType("text/plain; charset=x-user-defined"),u.setRequestHeader("If-Modified-Since","Sat, 1 Jan 1970 00:00:00 GMT"),u.onreadystatechange=function(){u.readyState==4&&(u.status==200?i(u):r(),u=null)},u.send(null))}return function(n,i,r){t(n,i,r)}}(),onShpFail=function(){alert("ajax fail ")},onShpComplete=function(n){var t=n.binaryResponse;alert("ajax success")};BinaryFile=function(n,t,i){var r=n,f=t||0,u=0;this.getRawData=function(){return r};typeof n=="string"?(u=i||r.length,this.getByteAt=function(n){return r.charCodeAt(n+f)&255}):typeof n=="unknown"&&(u=i||IEBinary_getLength(r),this.getByteAt=function(n){return IEBinary_getByteAt(r,n+f)});this.getLength=function(){return u};this.getSByteAt=function(n){var t=this.getByteAt(n);return t>127?t-256:t};this.getShortAt=function(n,t){var i=t?(this.getByteAt(n)<<8)+this.getByteAt(n+1):(this.getByteAt(n+1)<<8)+this.getByteAt(n);return i<0&&(i+=65536),i};this.getSShortAt=function(n,t){var i=this.getShortAt(n,t);return i>32767?i-65536:i};this.getLongAt=function(n,t){var r=this.getByteAt(n),u=this.getByteAt(n+1),f=this.getByteAt(n+2),e=this.getByteAt(n+3),i=t?(((r<<8)+u<<8)+f<<8)+e:(((e<<8)+f<<8)+u<<8)+r;return i<0&&(i+=4294967296),i};this.getSLongAt=function(n,t){var i=this.getLongAt(n,t);return i>2147483647?i-4294967296:i};this.getStringAt=function(n,t){for(var r=[],i=n,u=0;i<n+t;i++,u++)r[u]=String.fromCharCode(this.getByteAt(i));return r.join("")};this.getCharAt=function(n){return String.fromCharCode(this.getByteAt(n))};this.toBase64=function(){return window.btoa(r)};this.fromBase64=function(n){r=window.atob(n)}};BinaryAjax=function(){function n(){var n=null;return window.XMLHttpRequest?n=new XMLHttpRequest:window.ActiveXObject&&(n=new ActiveXObject("Microsoft.XMLHTTP")),n}function i(t,i,r){var u=n();u?(i&&(typeof u.onload!="undefined"?u.onload=function(){u.status=="200"?i(this):r&&r();u=null}:u.onreadystatechange=function(){u.readyState==4&&(u.status=="200"?i(this):r&&r(),u=null)}),u.open("HEAD",t,!0),u.send(null)):r&&r()}function t(t,i,r,u,f,e){var o=n(),s,h;o?(s=0,u&&!f&&(s=u[0]),h=0,u&&(h=u[1]-u[0]+1),i&&(typeof o.onload!="undefined"?o.onload=function(){o.status=="200"||o.status=="206"||o.status=="0"?(o.binaryResponse=new BinaryFile(o.responseText,s,h),o.fileSize=e||o.getResponseHeader("Content-Length"),i(o)):r&&r();o=null}:o.onreadystatechange=function(){if(o.readyState==4){if(o.status=="200"||o.status=="206"||o.status=="0"){var n={status:o.status,binaryResponse:new BinaryFile(o.responseBody,s,h),fileSize:e||o.getResponseHeader("Content-Length")};i(n)}else r&&r();o=null}}),o.open("GET",t,!0),o.overrideMimeType&&o.overrideMimeType("text/plain; charset=x-user-defined"),u&&f&&o.setRequestHeader("Range","bytes="+u[0]+"-"+u[1]),o.setRequestHeader("If-Modified-Since","Sat, 1 Jan 1970 00:00:00 GMT"),o.send(null)):r&&r()}return function(n,r,u,f){f?i(n,function(i){var o=parseInt(i.getResponseHeader("Content-Length"),10),h=i.getResponseHeader("Accept-Ranges"),e,s;e=f[0];f[0]<0&&(e+=o);s=e+f[1]-1;t(n,r,u,[e,s],h=="bytes",o)}):t(n,r,u)}}();document.write("<script type='text/vbscript'>\r\nFunction IEBinary_getByteAt(strBinary, iOffset)\r\n\tIEBinary_getByteAt = AscB(MidB(strBinary,iOffset+1,1))\r\nEnd Function\r\nFunction IEBinary_getLength(strBinary)\r\n\tIEBinary_getLength = LenB(strBinary)\r\nEnd Function\r\n<\/script>\r\n");